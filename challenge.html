<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„ÙƒØªØ§Ø¨Ø© </title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
    body { font-family: 'Cairo', sans-serif; background-color: #ffe0f0; direction: rtl; padding: 2rem; color: #222; text-align: center; }
    .container { max-width: 1000px; margin: auto; background-color: rgba(255,255,255,0.95); padding: 2rem; border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.08);} 
    .challenge-buttons{display:flex;justify-content:center;gap:20px;flex-wrap:wrap;margin-bottom:30px}
    .challenge-btn,.start-btn,button{background-color:#d6458b;color:#fff;padding:1rem 1.5rem;border:0;border-radius:10px;cursor:pointer;font-size:1.1rem;transition:.2s}
    .challenge-btn:hover,.start-btn:hover,button:hover{background:#b93b79}
    textarea,input[type="text"],input[type="email"],.typing-input{padding:1rem;font-size:1rem;width:80%;margin:10px auto;display:block;border-radius:10px;border:1px solid #ccc}
    #typing-input{width:100%}
    .typing-boxes{display:flex;justify-content:center;gap:15px;flex-wrap:wrap}
    .typing-box{width:60px;height:60px;background:#fff;border:2px solid #ccc;border-radius:10px;text-align:center;font-size:28px;line-height:60px}
    .correct{background:#d0f0d0;border-color:#2ecc71}
    .incorrect{background:#fce4e4;border-color:#e74c3c}
    #hand-test .letter-box{font-size:60px;margin:30px 0;color:#16a085}
    .quote{background:#ffd6e7;padding:1rem;margin:1rem 0;border-radius:10px;font-size:1.1rem;color:#b93b79}
    #timer,#timer-ch1,#timer-asl,#timer-lugz{font-size:1.1rem;font-weight:700;color:#d6458b;margin-top:1rem}
    .results-section{margin-top:1rem;text-align:right;font-size:1.05rem;background:#fff0f8;padding:1rem;border-radius:10px;max-height:300px;overflow:auto}
    .small{font-size:.9rem;color:#666}
    .map-box{background:#fff;padding:10px;border-radius:8px;display:inline-block;margin:10px 0}
  </style>
</head>
<body>
  <div class="container">
    <div id="start-screen">
      <h2>ğŸ¯ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„ÙƒØªØ§Ø¨Ø©</h2>
      <p class="quote">ğŸ’¡ ÙƒÙ„ Ø­Ø±Ù ØªÙƒØªØ¨Ù‡ Ù‡Ùˆ Ø®Ø·ÙˆØ© Ù†Ø­Ùˆ Ø§Ù„Ø¥ØªÙ‚Ø§Ù†ØŒ Ø§Ø¨Ø¯Ø£ Ø¨Ù‚ÙˆØ© ÙˆØ±ÙƒØ² Ø¨Ø¯Ù‚Ø©</p>
      <input type="text" id="user-name" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ" />
      <input type="email" id="user-email" placeholder="Ø§Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" />
      <button class="start-btn" onclick="beginChallenge()">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ø¯ÙŠ ğŸš€</button>
    </div>

    <div id="main-interface" style="display:none;">
      <h2>ğŸ¯ Ø§Ø®ØªØ± Ø§Ù„ØªØ­Ø¯ÙŠ</h2>
      <div class="challenge-buttons">
        <button class="challenge-btn" onclick="startChallenge1()">ğŸ® ØªØ­Ø¯ÙŠ 1</button>
        <button class="challenge-btn" onclick="startAslTest()">ğŸ Ø§Ù„ØªØ­Ø¯ÙŠ 2</button>
        <button class="challenge-btn" onclick="startHandTest()">ğŸ® Ø§Ù„ØªØ­Ø¯ÙŠ 3</button>
        <button class="challenge-btn" onclick="startLugzTest()">ğŸ§© Ø§Ù„ØªØ­Ø¯ÙŠ 4</button>
      </div>

      <!-- ===== ØªØ­Ø¯ÙŠ 1 ===== -->
      <div id="challenge1" style="display:none;">
        <h3>ğŸ¯ ØªØ­Ø¯ÙŠ Ø§Ù„Ø³Ø±Ø¹Ø© ÙˆØ§Ù„Ø¯Ù‚Ø© - Ù†Øµ Ù…Ù…ØªØ¯</h3>
        <p>ğŸ•’ Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ Ø§Ù„ØªØ§Ù„ÙŠ Ø¨Ø¯Ù‚Ø© Ø®Ù„Ø§Ù„ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯!</p>
        <div id="target-text" style="font-family:monospace;user-select:none;"> 
          fjkd fjkd fj fjkd kd fj fjkd kdfj jdfk djkf<br>
          dfkj fjkd kd kdjf jfkd ddff fj kkkk jfkd kdjk<br>
          fj jjkk fjk fjdj fjkd jdkf fj fkjd kjdf dfjk<br>
          fjdk ffff jfkd djkf fjkd ddjj jdfk kdjf fjkd
        </div>
        <textarea id="user-input" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§ ØªÙ…Ø§Ù…Ù‹Ø§ ÙƒÙ…Ø§ Ù‡Ùˆ Ø¸Ø§Ù‡Ø± Ø£Ø¹Ù„Ø§Ù‡..."></textarea>
        <div id="timer-ch1">â± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: 150 Ø«Ø§Ù†ÙŠØ©</div>
        <button id="finish-btn">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ</button>

        <div id="results-container" style="display:none;">
          <h2>ğŸ“Š Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ­Ø¯ÙŠ</h2>
          <p id="summary"></p>
          <div id="errors-list" class="results-section"></div>
          <button id="save-ch1" style="display:none;">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
          <button id="retry-btn">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ø¯ÙŠ</button>
        </div>
      </div>

      <!-- ===== ØªØ­Ø¯ÙŠ 2 (ASL) ===== -->
      <div id="asl-test" style="display:none;">
        <h3>ğŸ ØªØ­Ø¯ÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© - Ø­Ø±ÙˆÙ A S L ;</h3>
        <p>âœï¸ Ø§ÙƒØªØ¨ Ø§Ù„ØªØªØ§Ø¨Ø¹ Ø§Ù„ØªØ§Ù„ÙŠ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­:</p>
        <div id="phase-text" class="typing-boxes"></div>
        <input type="text" id="typing-input" class="typing-input" placeholder="Ø§Ø¨Ø¯Ø£ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ù‡Ù†Ø§...">
        <div id="timer-asl">â± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: 60 Ø«Ø§Ù†ÙŠØ©</div>
        <div class="result" id="feedback-asl"></div>
        <div id="result-asl"></div>
        <button id="save-asl" style="display:none;">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
      </div>

      <!-- ===== ØªØ­Ø¯ÙŠ 3 (Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙŠØ¯) ===== -->
      <div id="hand-test" style="display:none;">
        <h3>ğŸ® Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙŠØ¯ Ø§Ù„ØµØ­ÙŠØ­Ø© - 20 Ø¬ÙˆÙ„Ø©</h3>
        <div class="letter-box" id="letter-box">A</div>
        <div id="single-buttons">
          <button onclick="submitHand('left')">ğŸ‘ˆ ÙŠØ³Ø§Ø±</button>
          <button onclick="submitHand('right')">ğŸ‘‰ ÙŠÙ…ÙŠÙ†</button>
        </div>
        <div id="dual-buttons" style="display:none;flex-direction:column;gap:10px;">
          <button id="btn1" onclick="submitHand(this.dataset.choice)">â€”</button>
          <button id="btn2" onclick="submitHand(this.dataset.choice)">â€”</button>
        </div>
        <div id="feedback"></div>
        <div id="timer"></div>
        <div id="result"></div>
        <button id="save-hand" style="display:none;">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
      </div>

      <!-- ===== ØªØ­Ø¯ÙŠ 4 (Ø£Ù„ØºØ§Ø²) ===== -->
      <div id="lugz-test" style="display:none;">
        <h3>ğŸ§© ØªØ­Ø¯ÙŠ Ø§Ù„Ø£Ù„ØºØ§Ø² - Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±ÙŠØ©</h3>
        <p class="small">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Ù† 1 Ùˆ2 ÙŠØ¸Ù‡Ø±Ø§Ù† Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ù…Ø¨Ø§Ø´Ø±Ø©. Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª 3â€“6 Ø£Ù„ØºØ§Ø² â€” Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªÙ„Ù…ÙŠØ­ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©.</p>
        <p id="lugz-rule"></p>
        <div id="lugz-groups" style="font-family:monospace;margin:20px 0;"></div>
        <div class="map-box" id="home-row-map" style="display:none;">ØµÙ Ø§Ù„Ø§Ø±ØªÙƒØ§Ø²: a &nbsp; s &nbsp; d &nbsp; f &nbsp; g &nbsp; h &nbsp; j &nbsp; k &nbsp; l &nbsp; ;</div>
        <div><button onclick="toggleHomeRow()">ğŸ—ºï¸ Ø¹Ø±Ø¶ Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØµÙ</button></div>
        <input type="text" id="lugz-input" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±ÙŠØ© Ù‡Ù†Ø§...">
        <div id="timer-lugz"></div>
        <button id="submit-lugz-btn" onclick="submitLugz()">Ø¥Ø±Ø³Ø§Ù„</button>
        <button id="hint-lugz-btn" onclick="showHint()">ğŸ’¡ ØªÙ„Ù…ÙŠØ­</button>
        <button id="save-lugz" style="display:none;">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
        <div id="lugz-feedback" class="results-section"></div>
      </div>
    </div>
  </div>

  <!-- Ø£ØµÙˆØ§Øª Ù…Ø´ØªØ±ÙƒØ© -->
  <audio id="sound-success" src="https://www.soundjay.com/button/sounds/button-3.mp3" preload="auto"></audio>
  <audio id="sound-error" src="https://www.soundjay.com/button/sounds/button-10.mp3" preload="auto"></audio>
  <audio id="sound-timeout" src="https://www.soundjay.com/button/sounds/beep-06.mp3" preload="auto"></audio>

  <script>
    // ---------- Ù…Ø³Ø§Ø¹Ø¯Ø§Øª Ø¹Ø§Ù…Ø© ----------
    function getUserInfo(){ return { name: document.getElementById('user-name').value || 'Ù…Ø¬Ù‡ÙˆÙ„', email: document.getElementById('user-email').value || '' }; }
    function hideAll(){ ['challenge1','asl-test','hand-test','lugz-test'].forEach(id=>{ const e=document.getElementById(id); if(e) e.style.display='none'; }); }
    function beginChallenge(){ document.getElementById('start-screen').style.display='none'; document.getElementById('main-interface').style.display='block'; }
    const successSound = document.getElementById('sound-success'); const errorSound = document.getElementById('sound-error'); const timeoutSound = document.getElementById('sound-timeout');
    function playAudio(s){ try{ if(s && s.play) s.play(); }catch(e){} }

    // ---------- ØªØ­Ø¯ÙŠ 1 (ØªØ§ÙŠÙ…Ø± ÙŠØ¨Ø¯Ø£ Ø¹Ù†Ø¯ Ø£ÙˆÙ„ ÙƒØªØ§Ø¨Ø©) ----------
    function startChallenge1(){ hideAll(); document.getElementById('challenge1').style.display='block'; initChallenge1(); }
    function initChallenge1(){
      const target = document.getElementById('target-text').textContent.trim().replace(/\s+/g,' ');
      const input = document.getElementById('user-input'); const timerEl = document.getElementById('timer-ch1');
      const finishBtn = document.getElementById('finish-btn'); const resultsContainer = document.getElementById('results-container');
      const summary = document.getElementById('summary'); const errorsList = document.getElementById('errors-list');
      const retryBtn = document.getElementById('retry-btn'); const saveBtn = document.getElementById('save-ch1');

      let timeLeft = 150, interval = null, started=false;
      input.value=''; input.disabled=false; resultsContainer.style.display='none'; saveBtn.style.display='none';
      timerEl.textContent = `â± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${timeLeft} Ø«Ø§Ù†ÙŠØ©`;

      input.oninput = () => {
        if(!started){ started=true; interval = setInterval(()=>{ timeLeft--; timerEl.textContent = `â± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${timeLeft} Ø«Ø§Ù†ÙŠØ©`; if(timeLeft<=0){ clearInterval(interval); input.disabled=true; playAudio(timeoutSound); finishChallenge(); } },1000); }
      };

      finishBtn.onclick = finishChallenge; retryBtn.onclick = initChallenge1;

      function finishChallenge(){ clearInterval(interval); input.disabled=true; const typed = input.value.trim().replace(/\s+/g,' '); const timeUsed = 150 - timeLeft; const targetWords = target.split(' '); const typedWords = typed ? typed.split(' ') : []; let errors = [], correct = 0; for(let i=0;i<Math.max(targetWords.length, typedWords.length); i++){ const e = targetWords[i]||''; const a = typedWords[i]||''; if(e===a) correct++; else errors.push({pos:i+1,expected:e,actual:a}); }
        const accuracy = ((correct/targetWords.length)*100).toFixed(2); const speed = timeUsed>0 ? Math.round((typedWords.length)/(timeUsed/60)) : 0; const score = Math.max(correct - errors.length, 0);
        summary.innerHTML = `âœ… Ø§Ù„Ø¯Ù‚Ø©: ${accuracy}%<br>ğŸš€ Ø§Ù„Ø³Ø±Ø¹Ø©: ${speed} ÙƒÙ„Ù…Ø©/Ø¯Ù‚ÙŠÙ‚Ø©<br>ğŸ Ø§Ù„Ø¹Ù„Ø§Ù…Ø©: ${score} / ${targetWords.length}<br>âŒ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡: ${errors.length}<br>â± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${timeUsed} Ø«Ø§Ù†ÙŠØ©`;
        if(errors.length===0){ errorsList.innerHTML = '<p class="correct">ğŸ‰ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡!</p>'; playAudio(successSound); } else { errorsList.innerHTML = '<ul>' + errors.map(x=>`<li>ÙÙŠ Ø§Ù„ÙƒÙ„Ù…Ø© ${x.pos}: ÙƒØªØ¨Øª "${x.actual||'Ù„Ø§ Ø´ÙŠØ¡'}" Ø¨Ø¯Ù„ "${x.expected}"</li>`).join('') + '</ul>'; playAudio(errorSound); }
        saveBtn.style.display='inline-block'; saveBtn.onclick = () => saveResult('ØªØ­Ø¯ÙŠ_1', { challenge:'ØªØ­Ø¯ÙŠ 1', name:getUserInfo().name, email:getUserInfo().email, score, accuracy, speed, errors: errors.length, timeUsed, details: JSON.stringify(errors) });
        resultsContainer.style.display='block';
      }
    }

    // ---------- ØªØ­Ø¯ÙŠ 2 (ASL) - ØªØ§ÙŠÙ…Ø± ÙŠØ¨Ø¯Ø£ Ø¹Ù†Ø¯ Ø£ÙˆÙ„ ÙƒØªØ§Ø¨Ø© ----------
    const phases = ["AS;L",";LSA","S;LA","LAS;","A;SL"];
    let currentPhase=0, aslInterval=null, aslTimeDefault=60, aslTime=0, aslStarted=false, aslErrors=0;

    function startAslTest(){ hideAll(); document.getElementById('asl-test').style.display='block'; currentPhase=0; aslErrors=0; aslTime=aslTimeDefault; aslStarted=false; document.getElementById('timer-asl').textContent = `â± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${aslTime} Ø«Ø§Ù†ÙŠØ©`; renderPhase(); }

    function renderPhase(){
      const boxes = document.getElementById('phase-text'); const input = document.getElementById('typing-input'); const feedback = document.getElementById('feedback-asl'); boxes.innerHTML='';
      if(currentPhase >= phases.length) return finishAsl();
      phases[currentPhase].split('').forEach(c=>{ const d=document.createElement('div'); d.className='typing-box'; d.textContent=c; boxes.appendChild(d); });
      input.value=''; input.disabled=false; feedback.textContent='';

      input.oninput = () => {
        if(!aslStarted){ aslStarted=true; aslInterval = setInterval(()=>{ aslTime--; document.getElementById('timer-asl').textContent = `â± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${aslTime} Ø«Ø§Ù†ÙŠØ©`; if(aslTime<=0){ clearInterval(aslInterval); playAudio(timeoutSound); finishAsl(); } },1000); }
        const expected = phases[currentPhase]; const typed = input.value; const boxEls = document.querySelectorAll('.typing-box');
        boxEls.forEach((box,i)=>{ box.className='typing-box'; if(typed[i]===expected[i]) box.classList.add('correct'); else if(typed[i]) box.classList.add('incorrect'); });
        if(typed === expected){ playAudio(successSound); currentPhase++; if(currentPhase < phases.length) renderPhase(); else finishAsl(); }
        else if(typed.length === expected.length && typed !== expected){ aslErrors++; playAudio(errorSound); feedback.innerHTML = 'âŒ Ø®Ø·Ø£'; }
      };
    }

    function finishAsl(){ clearInterval(aslInterval); document.getElementById('typing-input').disabled=true; const timeUsed = aslStarted ? (aslTimeDefault - Math.max(0, aslTime)) : 0; let score = (currentPhase * 100) - (aslErrors * 20); if(score<0) score=0; document.getElementById('result-asl').innerHTML = `âœ… Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„ØµØ­ÙŠØ­Ø©: ${currentPhase}/${phases.length}<br>âŒ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡: ${aslErrors}<br>ğŸ† Ø§Ù„Ù†Ù‚Ø§Ø·: ${score}<br>â± Ø§Ù„ÙˆÙ‚Øª: ${timeUsed} Ø«Ø§Ù†ÙŠØ©`;
      const saveBtn = document.getElementById('save-asl'); saveBtn.style.display='inline-block'; saveBtn.onclick = () => saveResult('ØªØ­Ø¯ÙŠ_2_ASL', { challenge:'ØªØ­Ø¯ÙŠ 2 - ASL', name:getUserInfo().name, email:getUserInfo().email, score, phasesDone: currentPhase, errors: aslErrors, timeUsed }); }

    // ---------- ØªØ­Ø¯ÙŠ 3 (Ø§Ù„ÙŠØ¯) - ÙˆÙ‚Øª 60 Ø«Ø§Ù†ÙŠØ© ÙŠØ¨Ø¯Ø£ Ø¹Ù†Ø¯ Ø£ÙˆÙ„ Ø¥Ø¬Ø§Ø¨Ø© ----------
    const handLetters = [ { char:'A', hand:'left' }, { char:'S', hand:'left' }, { char:'D', hand:'left' }, { char:'F', hand:'left' }, { char:'J', hand:'right' }, { char:'K', hand:'right' }, { char:'L', hand:'right' }, { char:';', hand:'right' }, { char:'AL', hand:'right-left' }, { char:'KS', hand:'right-left' }, { char:'DJ', hand:'left-right' }, { char:'FA', hand:'left-left' }, { char:'LK', hand:'right-right' }, { char:'S;', hand:'left-right' }, { char:'AD', hand:'left-left' }, { char:'JK', hand:'right-right' }, { char:'F;', hand:'left-right' }, { char:'DL', hand:'left-right' }, { char:'AS', hand:'left-left' }, { char:'K;', hand:'right-right' } ];
    let currentLetter={}, currentRound=0, handScore=0, handTimeDefault=60, handTime=0, handInterval=null, handStarted=false;

    function startHandTest(){ hideAll(); document.getElementById('hand-test').style.display='block'; currentRound=0; handScore=0; handStarted=false; handTime = handTimeDefault; document.getElementById('timer').textContent = `â± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${handTime} Ø«Ø§Ù†ÙŠØ©`; document.getElementById('result').textContent=''; nextRound(); }

    function nextRound(){ currentLetter = handLetters[Math.floor(Math.random()*handLetters.length)]; document.getElementById('letter-box').textContent = currentLetter.char; document.getElementById('feedback').textContent=''; document.getElementById('timer').textContent = `Ø§Ù„Ø¬ÙˆÙ„Ø© ${currentRound+1} Ù…Ù† 20`;
      if(currentLetter.char.length===1){ document.getElementById('single-buttons').style.display='block'; document.getElementById('dual-buttons').style.display='none'; }
      else { document.getElementById('single-buttons').style.display='none'; document.getElementById('dual-buttons').style.display='flex'; const btn1=document.getElementById('btn1'), btn2=document.getElementById('btn2'); const choices={ 'left-left':'ÙŠØ³Ø§Ø± Ø«Ù… ÙŠØ³Ø§Ø±','left-right':'ÙŠØ³Ø§Ø± Ø«Ù… ÙŠÙ…ÙŠÙ†','right-left':'ÙŠÙ…ÙŠÙ† Ø«Ù… ÙŠØ³Ø§Ø±','right-right':'ÙŠÙ…ÙŠÙ† Ø«Ù… ÙŠÙ…ÙŠÙ†' }; const correct=currentLetter.hand; let wrongOptions = Object.keys(choices).filter(c=>c!==correct); let wrong = wrongOptions[Math.floor(Math.random()*wrongOptions.length)]; if(Math.random()<0.5){ btn1.textContent=choices[correct]; btn1.dataset.choice=correct; btn2.textContent=choices[wrong]; btn2.dataset.choice=wrong; } else { btn1.textContent=choices[wrong]; btn1.dataset.choice=wrong; btn2.textContent=choices[correct]; btn2.dataset.choice=correct; } }
    }

    function submitHand(choice){ if(!handStarted){ handStarted=true; handInterval = setInterval(()=>{ handTime--; document.getElementById('timer').textContent = `â± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${handTime} Ø«Ø§Ù†ÙŠØ©`; if(handTime<=0){ clearInterval(handInterval); playAudio(timeoutSound); showResult(); } },1000); }
      if(!choice) return; if(choice === currentLetter.hand){ handScore++; document.getElementById('feedback').textContent='âœ”ï¸ ØµØ­ÙŠØ­'; playAudio(successSound); } else { document.getElementById('feedback').textContent='âŒ Ø®Ø·Ø£'; playAudio(errorSound); }
      currentRound++; if(currentRound < 20) setTimeout(nextRound,500); else { clearInterval(handInterval); showResult(); } }

    function showResult(){ document.getElementById('letter-box').style.display='none'; document.getElementById('feedback').style.display='none'; document.getElementById('timer').style.display='none'; document.getElementById('result').textContent = `ğŸ‰ Ù„Ù‚Ø¯ Ø£Ø¬Ø¨Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ø¹Ù„Ù‰ ${handScore} Ù…Ù† ${currentRound} Ø¬ÙˆÙ„Ø©!`;
      const saveBtn = document.getElementById('save-hand'); saveBtn.style.display='inline-block'; saveBtn.onclick = () => saveResult('ØªØ­Ø¯ÙŠ_3_Ø§Ù„ÙŠØ¯',{ challenge:'ØªØ­Ø¯ÙŠ 3 - Ø§Ù„ÙŠØ¯', name:getUserInfo().name, email:getUserInfo().email, correct:handScore, attempts:currentRound, timeUsed: handTimeDefault - handTime }); }

    // ---------- ØªØ­Ø¯ÙŠ 4 (Ø£Ù„ØºØ§Ø²) Ù…Ø¹ Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù…Ù† undefined ---------- -20fales +100 true -30ØªÙ„Ù…ÙŠØ­ 
    const lugzLevels = [
      { groups:["afsd","agkh","ahsj","ajlk","akdf","al;d"], rule:"Ø®Ø° Ø§Ù„Ø­Ø±Ù Ø§Ù„Ø«Ø§Ù†ÙŠ Ù…Ù† ÙƒÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø©", solution:"fghjkl", time:50 },
      { groups:["asdfj","jsfga","asdfh","asgj;","asdfg"], rule:"Ø®Ø° Ø§Ù„Ø­Ø±Ù Ø§Ù„Ø£Ø®ÙŠØ± Ù…Ù† ÙƒÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø©", solution:"jah;g", time:50 },
      { groups:["asdfj","jlfga","ashfh","asgl;","asdfj"], rule:"  ...Ø®Ø° Ø§Ù„Ø­Ø±ÙˆÙ Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨: Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø£ÙˆÙ„ Ø­Ø±ÙØŒ Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø«Ø§Ù†ÙŠ Ø­Ø±Ù", solution:"alhgj", time:60 },
      { groups:["alk","akj","ajd","ahk","agf","afl","sas"], rule:null, solution:"lkjhgfa", time:75 },
      { groups:["gk;d","hgkf","gh;h","dkjd",";;l;","fklj"], rule:null, solution:"ghgd;f", time:75 },
      { groups:["asdj","fkgl",";hsa","ajfg","k;ld","dhjf"], rule:null, solution:"dgsflj", time:80},
      { groups:["akdf","asgj","adlj","gk;f","aslf","j;kd"], rule:null, solution:";skdsk", time:80 }
    ];
    const hiddenRules = { 2: 'Ø®Ø° Ø§Ù„Ø­Ø±Ù Ø§Ù„Ø£ÙˆØ³Ø· Ù…Ù† ÙƒÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø©', 3: 'Ø®Ø° Ø§Ù„Ø­Ø±Ù Ø§Ù„Ø£ÙˆÙ„ Ù…Ù† ÙƒÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø©', 4: 'Ø®Ø° Ø§Ù„Ø­Ø±Ù Ø±Ù‚Ù… 3 Ù…Ù† ÙƒÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø©', 5: 'Ø®Ø° Ø§Ù„Ø­Ø±Ù Ø§Ù„Ø«Ø§Ù†ÙŠ Ù…Ù† ÙƒÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø«Ù… Ø§Ù‚Ù„Ø¨ Ø§Ù„Ù†ØªÙŠØ¬Ø©' };

    let currentLugz = 0, lugzInterval = null, lugzTime = 0, lugzScore = 0, hintUsed = 0;

    function startLugzTest(){ hideAll(); document.getElementById('lugz-test').style.display='block'; currentLugz=0; lugzScore=0; hintUsed=0; loadLugzLevel(); }

    function toggleHomeRow(){ const el=document.getElementById('home-row-map'); el.style.display = el.style.display === 'none' ? 'inline-block' : 'none'; }

    function loadLugzLevel(){
      // Ø­Ù…Ø§ÙŠØ©: Ø¥Ø°Ø§ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª
      if(currentLugz >= lugzLevels.length){ document.getElementById('lugz-rule').textContent = ''; document.getElementById('lugz-groups').textContent = ''; document.getElementById('lugz-feedback').innerHTML = `<strong>ğŸ‰ Ø§Ù†ØªÙ‡ÙŠØª Ù…Ù† ÙƒÙ„ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª! Ù…Ø¬Ù…ÙˆØ¹ Ù†Ù‚Ø§Ø·Ùƒ: ${lugzScore}</strong>`; document.getElementById('lugz-input').style.display='none'; document.getElementById('submit-lugz-btn').style.display='none'; document.getElementById('hint-lugz-btn').style.display='none'; document.getElementById('save-lugz').style.display='inline-block'; document.getElementById('save-lugz').onclick = () => saveResult('ØªØ­Ø¯ÙŠ_4_Ø§Ù„ÙƒÙ„ÙŠ',{ challenge:'ØªØ­Ø¯ÙŠ 4 - Ø§Ù„ÙƒÙ„', name:getUserInfo().name, email:getUserInfo().email, totalScore:lugzScore }); return; }

      const level = lugzLevels[currentLugz];
      document.getElementById('lugz-groups').textContent = level.groups.join('   ');
      document.getElementById('lugz-input').value = ''; document.getElementById('lugz-input').style.display='inline-block';
      document.getElementById('lugz-feedback').textContent = ''; hintUsed = 0;
      if(level.rule) document.getElementById('lugz-rule').textContent = 'ğŸ“– Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©: ' + level.rule; else document.getElementById('lugz-rule').textContent = 'ğŸ” Ø­Ø§ÙˆÙ„ ØªÙƒØªØ´Ù Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø¨Ù†ÙØ³Ùƒ! (Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ø­Ø±ÙˆÙ Ù…Ù† ØµÙ Ø§Ù„Ø§Ø±ØªÙƒØ§Ø² a s d f g h j k l ;)';
      lugzTime = level.time; document.getElementById('timer-lugz').textContent = `â± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${lugzTime} Ø«Ø§Ù†ÙŠØ©`;
      clearInterval(lugzInterval);
      lugzInterval = setInterval(()=>{ lugzTime--; document.getElementById('timer-lugz').textContent = `â± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${lugzTime} Ø«Ø§Ù†ÙŠØ©`; if(lugzTime<=0){ clearInterval(lugzInterval); playAudio(timeoutSound); submitLugz(); } },1000);
    }

    function submitLugz(){
      // Ø­Ù…Ø§ÙŠØ©: ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø³ØªÙˆÙ‰
      if(currentLugz >= lugzLevels.length){ document.getElementById('lugz-feedback').textContent = 'ğŸ‰ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª Ø¨Ø§Ù„ÙØ¹Ù„.'; return; }
      clearInterval(lugzInterval);
      const level = lugzLevels[currentLugz];
      if(!level){ document.getElementById('lugz-feedback').textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£: Ù…Ø³ØªÙˆÙ‰ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ.'; return; }

      const ans = document.getElementById('lugz-input').value.trim(); let feedback = '';
      if(ans === level.solution){ feedback = `âœ… ØµØ­ÙŠØ­! Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±ÙŠØ© = ${level.solution}`; playAudio(successSound); lugzScore += 100; }
      else { feedback = `âŒ Ø®Ø·Ø£! Ø§Ù„ØµØ­ÙŠØ­ ÙƒØ§Ù† ${level.solution}`; playAudio(errorSound); lugzScore -= 20; }
      if(hintUsed>0) lugzScore -= (hintUsed * 30);
      document.getElementById('lugz-feedback').innerHTML = feedback + `<br>ğŸ† Ù†Ù‚Ø§Ø·Ùƒ: ${lugzScore}`;

      const saveBtn = document.getElementById('save-lugz'); saveBtn.style.display='inline-block'; saveBtn.onclick = () => saveResult('ØªØ­Ø¯ÙŠ_4_Ù…Ø³ØªÙˆÙ‰_'+(currentLugz+1), { challenge:'ØªØ­Ø¯ÙŠ 4', level: currentLugz+1, name:getUserInfo().name, email:getUserInfo().email, answer: ans, correct: level.solution, score: lugzScore });

      currentLugz++;
      if(currentLugz < lugzLevels.length) setTimeout(loadLugzLevel, 1200); else setTimeout(loadLugzLevel, 800);
    }

    function showHint(){
      if(currentLugz >= lugzLevels.length){ document.getElementById('lugz-feedback').textContent = 'ğŸ‰ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§ØªØŒ Ù„Ø§ ØªÙ„Ù…ÙŠØ­Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©.'; return; }
      const level = lugzLevels[currentLugz]; if(!level) return;
      if(level.rule){ document.getElementById('lugz-feedback').textContent = 'ğŸ“– Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ù…Ø¹Ø±ÙˆØ¶Ø© Ø¨Ø§Ù„ÙØ¹Ù„ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙˆÙ‰.'; return; }
      hintUsed++;
      if(hintUsed===1){ document.getElementById('lugz-feedback').textContent = 'ğŸ’¡ ØªÙ„Ù…ÙŠØ­ Ø£ÙˆÙ„: Ø§Ù„Ø­Ø±ÙˆÙ Ø¬Ù…ÙŠØ¹Ù‡Ø§ Ù…Ù† ØµÙ Ø§Ù„Ø§Ø±ØªÙƒØ§Ø² (a s d f g h j k l ;)Ø› Ø±ÙƒØ² Ø¹Ù„Ù‰ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø±Ù Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¨Ù„ÙˆÙƒ.'; }
      else { const ruleText = hiddenRules[currentLugz] || 'Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©: (Ù…ÙƒØ´ÙˆÙ)'; document.getElementById('lugz-feedback').textContent = 'ğŸ“– Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©: ' + ruleText; }
    }

    // ---------- Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ (CSV ØªÙ†Ø²ÙŠÙ„) ----------
    function saveResult(filenameLabel, details){ const now = new Date(); const ts = now.toISOString().replace(/[:.]/g,'-'); const filename = `${filenameLabel.replace(/\s+/g,'_')}_${ts}.csv`; const keys = Object.keys(details); const escape = v => '"' + String(v||'').replace(/"/g,'""') + '"'; const header = keys.join(',') + '\n'; const row = keys.map(k=>escape(details[k])).join(',') + '\n'; const csv = header + row; const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' }); const link = document.createElement('a'); link.href = URL.createObjectURL(blob); link.download = filename; document.body.appendChild(link); link.click(); document.body.removeChild(link); alert('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ù†ØªØ§Ø¦Ø¬: ' + filename); }
  </script>
</body>
</html>
